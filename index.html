<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rust WASM Crypto Demo</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            line-height: 1.6;
        }

        .section {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            border-left: 4px solid #007bff;
        }

        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            margin: 5px;
        }

        button:hover {
            background: #0056b3;
        }

        textarea {
            width: 100%;
            height: 100px;
            font-family: 'Courier New', monospace;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            margin: 10px 0;
            resize: vertical;
        }

        .result {
            background: white;
            padding: 15px;
            border-radius: 5px;
            border: 1px solid #ddd;
            margin: 10px 0;
            font-family: 'Courier New', monospace;
            word-break: break-all;
        }

        .controls {
            margin: 10px 0;
        }

        .label {
            font-weight: bold;
            margin: 10px 0 5px 0;
            display: block;
        }

        code {
            background: #e9ecef;
            padding: 2px 5px;
            border-radius: 3px;
            font-family: 'Courier New', monospace;
        }
    </style>
</head>

<body>
    <h1>üîê Rust WASM Crypto Demo</h1>

    <!-- –°–∏–º–º–µ—Ç—Ä–∏—á–Ω–æ–µ —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ -->
    <div class="section">
        <h2>üîë –°–∏–º–º–µ—Ç—Ä–∏—á–Ω–æ–µ —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ (AES-256-GCM)</h2>

        <div class="controls">
            <button onclick="generateSymmetricKey()">–°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å —Å–∏–º–º–µ—Ç—Ä–∏—á–Ω—ã–π –∫–ª—é—á</button>
        </div>

        <div class="label">–°–∏–º–º–µ—Ç—Ä–∏—á–Ω—ã–π –∫–ª—é—á (32 –±–∞–π—Ç–∞, hex):</div>
        <textarea id="symmetricKey" placeholder="–°–≥–µ–Ω–µ—Ä–∏—Ä—É–π—Ç–µ –∫–ª—é—á..."></textarea>

        <div class="label">–¢–µ–∫—Å—Ç –¥–ª—è —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è:</div>
        <textarea id="symmetricText">–ü—Ä–∏–≤–µ—Ç, –º–∏—Ä! –≠—Ç–æ —Ç–µ—Å—Ç–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ.</textarea>

        <div class="controls">
            <button id="generateSymKeyBtn">–°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å —Å–∏–º–º–µ—Ç—Ä–∏—á–Ω—ã–π –∫–ª—é—á</button>
        </div>

        <div class="controls">
            <button id="encryptSymBtn">–ó–∞—à–∏—Ñ—Ä–æ–≤–∞—Ç—å</button>
            <button id="decryptSymBtn">–†–∞—Å—à–∏—Ñ—Ä–æ–≤–∞—Ç—å</button>
        </div>


        <div class="label">–†–µ–∑—É–ª—å—Ç–∞—Ç:</div>
        <div class="result" id="symmetricResult"></div>
    </div>

    <!-- –ê—Å–∏–º–º–µ—Ç—Ä–∏—á–Ω–æ–µ —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ -->
    <div class="section">
        <h2>üóùÔ∏è –ê—Å–∏–º–º–µ—Ç—Ä–∏—á–Ω–æ–µ —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ (RSA-2048)</h2>

        <div class="controls">
            <button onclick="generateAsymmetricKeypair()">–°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –∫–ª—é—á–µ–≤—É—é –ø–∞—Ä—É</button>
        </div>

        <div class="label">–ü—Ä–∏–≤–∞—Ç–Ω—ã–π –∫–ª—é—á (PEM):</div>
        <textarea id="privateKey" placeholder="–ë—É–¥–µ—Ç —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω..."></textarea>

        <div class="label">–ü—É–±–ª–∏—á–Ω—ã–π –∫–ª—é—á (PEM):</div>
        <textarea id="publicKey" placeholder="–ë—É–¥–µ—Ç —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω..."></textarea>

        <div class="label">–¢–µ–∫—Å—Ç –¥–ª—è —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è:</div>
        <textarea id="asymmetricText">–°–µ–∫—Ä–µ—Ç–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –¥–ª—è RSA</textarea>

        <div class="controls">
            <button id="generateAsymKeypairBtn">–°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –∫–ª—é—á–µ–≤—É—é –ø–∞—Ä—É</button>
        </div>

        <div class="controls">
            <button id="encryptAsymBtn">–ó–∞—à–∏—Ñ—Ä–æ–≤–∞—Ç—å –ø—É–±–ª–∏—á–Ω—ã–º –∫–ª—é—á–æ–º</button>
            <button id="decryptAsymBtn">–†–∞—Å—à–∏—Ñ—Ä–æ–≤–∞—Ç—å –ø—Ä–∏–≤–∞—Ç–Ω—ã–º –∫–ª—é—á–æ–º</button>
        </div>

        <div class="label">–†–µ–∑—É–ª—å—Ç–∞—Ç:</div>
        <div class="result" id="asymmetricResult"></div>
    </div>

    <!-- –£—Ç–∏–ª–∏—Ç—ã -->
    <div class="section">
        <h2>üõ†Ô∏è –£—Ç–∏–ª–∏—Ç—ã</h2>
        <div class="controls">
            <button id="generateRandomBtn">–°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å —Å–ª—É—á–∞–π–Ω—ã–µ –±–∞–π—Ç—ã</button>
            <button id="hashDataBtn">–í—ã—á–∏—Å–ª–∏—Ç—å SHA-256</button>
        </div>

        <div class="label">–î–∞–Ω–Ω—ã–µ –¥–ª—è —Ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è:</div>
        <textarea id="hashText">–î–∞–Ω–Ω—ã–µ –¥–ª—è —Ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è</textarea>

        <div class="label">–†–µ–∑—É–ª—å—Ç–∞—Ç:</div>
        <div class="result" id="utilsResult"></div>
    </div>

    <!-- –ö–æ–Ω—Å–æ–ª—å —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞ -->
    <div class="section">
        <h2>üíª –î–ª—è –∫–æ–Ω—Å–æ–ª–∏ —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞</h2>
        <p>–í—Å–µ —Ñ—É–Ω–∫—Ü–∏–∏ –¥–æ—Å—Ç—É–ø–Ω—ã –≥–ª–æ–±–∞–ª—å–Ω–æ —á–µ—Ä–µ–∑ <code>window.cryptoAPI</code></p>
        <pre><code>
// –î–æ—Å—Ç—É–ø–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏:
window.cryptoAPI.generate_symmetric_key()
window.cryptoAPI.encrypt_symmetric(plaintext, keyHex)
window.cryptoAPI.decrypt_symmetric(encryptedJson, keyHex)
window.cryptoAPI.generate_asymmetric_keypair()
window.cryptoAPI.encrypt_asymmetric(plaintext, publicKeyPem)
window.cryptoAPI.decrypt_asymmetric(ciphertextHex, privateKeyPem)
window.cryptoAPI.hash_sha256(data)
window.cryptoAPI.generate_random_bytes(count)
        </code></pre>
    </div>
    <script type="module">
        import init, {
            generate_symmetric_key,
            encrypt_symmetric,
            decrypt_symmetric,
            generate_asymmetric_keypair,
            encrypt_asymmetric,
            decrypt_asymmetric,
            hash_sha256,
            generate_random_bytes
        } from './pkg/rust_wasm_crypto.js';

        let wasmInitialized = false;

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ WASM (–¥–µ–ª–∞–µ–º –µ—ë –≥–ª–æ–±–∞–ª—å–Ω–æ–π)
        window.initCrypto = async function () {
            if (!wasmInitialized) {
                await init();
                wasmInitialized = true;
                console.log('‚úÖ WASM Crypto API initialized!');
            }
            return true;
        };

        // –î–µ–ª–∞–µ–º —Ñ—É–Ω–∫—Ü–∏–∏ –≥–ª–æ–±–∞–ª—å–Ω–æ –¥–æ—Å—Ç—É–ø–Ω—ã–º–∏
        window.cryptoAPI = {
            generate_symmetric_key,
            encrypt_symmetric,
            decrypt_symmetric,
            generate_asymmetric_keypair,
            encrypt_asymmetric,
            decrypt_asymmetric,
            hash_sha256,
            generate_random_bytes
        };

        // –ì–ª–æ–±–∞–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è –∫–Ω–æ–ø–æ–∫
        window.generateSymmetricKey = async function () {
            await window.initCrypto();
            try {
                const key = await window.cryptoAPI.generate_symmetric_key();
                document.getElementById('symmetricKey').value = key;
                document.getElementById('symmetricResult').innerHTML =
                    `<strong>–ö–ª—é—á —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω:</strong> ${key.substring(0, 50)}...`;
                console.log('Symmetric key:', key);
            } catch (error) {
                document.getElementById('symmetricResult').innerHTML =
                    `<strong>–û—à–∏–±–∫–∞:</strong> ${error}`;
            }
        };

        window.encryptSymmetric = async function () {
            await window.initCrypto();
            try {
                const plaintext = document.getElementById('symmetricText').value;
                const key = document.getElementById('symmetricKey').value;

                if (!key) {
                    alert('–°–Ω–∞—á–∞–ª–∞ —Å–≥–µ–Ω–µ—Ä–∏—Ä—É–π—Ç–µ –∫–ª—é—á!');
                    return;
                }

                const encrypted = await window.cryptoAPI.encrypt_symmetric(plaintext, key);
                document.getElementById('symmetricResult').innerHTML =
                    `<strong>–ó–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–æ:</strong><br>${encrypted}`;
                console.log('Encrypted (JSON):', encrypted);
            } catch (error) {
                document.getElementById('symmetricResult').innerHTML =
                    `<strong>–û—à–∏–±–∫–∞ —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è:</strong> ${error}`;
            }
        };

        window.decryptSymmetric = async function () {
            await window.initCrypto();
            try {
                const key = document.getElementById('symmetricKey').value;
                const resultText = document.getElementById('symmetricResult').textContent;

                // –ò—â–µ–º JSON –≤ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–µ
                let jsonData = null;
                try {
                    const jsonMatch = resultText.match(/{[\s\S]*}/);
                    if (jsonMatch) {
                        jsonData = jsonMatch[0];
                    }
                } catch (e) {
                    // –ï—Å–ª–∏ –Ω–µ –Ω–∞—à–ª–∏ JSON, –ø–æ–ø—Ä–æ–±—É–µ–º –ø–æ–ª—É—á–∏—Ç—å –∏–∑ –ø–æ–ª—è –≤–≤–æ–¥–∞
                    jsonData = document.getElementById('symmetricResult').textContent;
                }

                if (!jsonData) {
                    alert('–°–Ω–∞—á–∞–ª–∞ –∑–∞—à–∏—Ñ—Ä—É–π—Ç–µ —á—Ç–æ-–Ω–∏–±—É–¥—å!');
                    return;
                }

                const decrypted = await window.cryptoAPI.decrypt_symmetric(jsonData, key);
                document.getElementById('symmetricResult').innerHTML =
                    `<strong>–†–∞—Å—à–∏—Ñ—Ä–æ–≤–∞–Ω–æ:</strong> ${decrypted}`;
                console.log('Decrypted:', decrypted);
            } catch (error) {
                document.getElementById('symmetricResult').innerHTML =
                    `<strong>–û—à–∏–±–∫–∞ —Ä–∞—Å—à–∏—Ñ—Ä–æ–≤–∫–∏:</strong> ${error}`;
            }
        };

        window.generateAsymmetricKeypair = async function () {
            await window.initCrypto();
            try {
                const keypairJson = await window.cryptoAPI.generate_asymmetric_keypair();
                const keypair = JSON.parse(keypairJson);

                document.getElementById('privateKey').value = keypair.private_key;
                document.getElementById('publicKey').value = keypair.public_key;

                document.getElementById('asymmetricResult').innerHTML =
                    `<strong>–ö–ª—é—á–µ–≤–∞—è –ø–∞—Ä–∞ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–∞!</strong><br>
                 <small>–ü—Ä–∏–≤–∞—Ç–Ω—ã–π –∫–ª—é—á: ${keypair.private_key.substring(0, 50)}...</small>`;
                console.log('Keypair generated');
            } catch (error) {
                document.getElementById('asymmetricResult').innerHTML =
                    `<strong>–û—à–∏–±–∫–∞:</strong> ${error}`;
            }
        };

        window.encryptAsymmetric = async function () {
            await window.initCrypto();
            try {
                const plaintext = document.getElementById('asymmetricText').value;
                const publicKey = document.getElementById('publicKey').value;

                if (!publicKey) {
                    alert('–°–Ω–∞—á–∞–ª–∞ —Å–≥–µ–Ω–µ—Ä–∏—Ä—É–π—Ç–µ –∫–ª—é—á–µ–≤—É—é –ø–∞—Ä—É!');
                    return;
                }

                const encrypted = await window.cryptoAPI.encrypt_asymmetric(plaintext, publicKey);
                document.getElementById('asymmetricResult').innerHTML =
                    `<strong>–ó–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–æ (hex):</strong><br>${encrypted}`;
                console.log('RSA Encrypted:', encrypted);
            } catch (error) {
                document.getElementById('asymmetricResult').innerHTML =
                    `<strong>–û—à–∏–±–∫–∞ —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è:</strong> ${error}`;
            }
        };

        window.decryptAsymmetric = async function () {
            await window.initCrypto();
            try {
                const privateKey = document.getElementById('privateKey').value;
                const resultText = document.getElementById('asymmetricResult').textContent;

                if (!resultText || resultText.length < 10) {
                    alert('–°–Ω–∞—á–∞–ª–∞ –∑–∞—à–∏—Ñ—Ä—É–π—Ç–µ —á—Ç–æ-–Ω–∏–±—É–¥—å!');
                    return;
                }

                // –ò–∑–≤–ª–µ–∫–∞–µ–º hex –∏–∑ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ - –ø—Ä–æ—Å—Ç–æ–π —Å–ø–æ—Å–æ–±
                let hexData = null;
                // –ò—â–µ–º –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å hex —Å–∏–º–≤–æ–ª–æ–≤ (–º–∏–Ω–∏–º—É–º 100 —Å–∏–º–≤–æ–ª–æ–≤)
                const hexMatch = resultText.match(/([0-9a-fA-F]{100,})/);
                if (hexMatch) {
                    hexData = hexMatch[1];
                } else {
                    // –ï—Å–ª–∏ –Ω–µ –Ω–∞—à–ª–∏, –∏—Å–ø–æ–ª—å–∑—É–µ–º –≤–µ—Å—å —Ç–µ–∫—Å—Ç
                    hexData = resultText.trim();
                }

                const decrypted = await window.cryptoAPI.decrypt_asymmetric(hexData, privateKey);
                document.getElementById('asymmetricResult').innerHTML =
                    `<strong>–†–∞—Å—à–∏—Ñ—Ä–æ–≤–∞–Ω–æ:</strong> ${decrypted}`;
                console.log('RSA Decrypted:', decrypted);
            } catch (error) {
                document.getElementById('asymmetricResult').innerHTML =
                    `<strong>–û—à–∏–±–∫–∞ —Ä–∞—Å—à–∏—Ñ—Ä–æ–≤–∫–∏:</strong> ${error}`;
            }
        };

        window.generateRandomBytes = async function () {
            await window.initCrypto();
            try {
                const bytes = await window.cryptoAPI.generate_random_bytes(32);
                document.getElementById('utilsResult').innerHTML =
                    `<strong>32 —Å–ª—É—á–∞–π–Ω—ã—Ö –±–∞–π—Ç–∞ (hex):</strong><br>${bytes}`;
                console.log('Random bytes:', bytes);
            } catch (error) {
                document.getElementById('utilsResult').innerHTML =
                    `<strong>–û—à–∏–±–∫–∞:</strong> ${error}`;
            }
        };

        window.hashData = async function () {
            await window.initCrypto();
            try {
                const data = document.getElementById('hashText').value;
                const hash = await window.cryptoAPI.hash_sha256(data);
                document.getElementById('utilsResult').innerHTML =
                    `<strong>SHA-256 —Ö–µ—à:</strong><br>${hash}`;
                console.log('SHA-256:', hash);
            } catch (error) {
                document.getElementById('utilsResult').innerHTML =
                    `<strong>–û—à–∏–±–∫–∞:</strong> ${error}`;
            }
        };

        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        window.initCrypto().catch(console.error);
    </script>
    <script>
        // –ü—Ä–æ–≤–µ—Ä–∫–∞, —á—Ç–æ —Ñ—É–Ω–∫—Ü–∏–∏ –¥–æ—Å—Ç—É–ø–Ω—ã
        window.addEventListener('load', function () {
            console.log('Page loaded, checking functions...');
            console.log('initCrypto available:', typeof window.initCrypto === 'function');
            console.log('encryptSymmetric available:', typeof window.encryptSymmetric === 'function');
        });
    </script>
</body>

</html>