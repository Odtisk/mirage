<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rust WASM Crypto Demo</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            line-height: 1.6;
        }
        .section {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            border-left: 4px solid #007bff;
        }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            margin: 5px;
        }
        button:hover {
            background: #0056b3;
        }
        textarea {
            width: 100%;
            height: 100px;
            font-family: 'Courier New', monospace;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            margin: 10px 0;
            resize: vertical;
        }
        .result {
            background: white;
            padding: 15px;
            border-radius: 5px;
            border: 1px solid #ddd;
            margin: 10px 0;
            font-family: 'Courier New', monospace;
            word-break: break-all;
        }
        .controls {
            margin: 10px 0;
        }
        .label {
            font-weight: bold;
            margin: 10px 0 5px 0;
            display: block;
        }
        code {
            background: #e9ecef;
            padding: 2px 5px;
            border-radius: 3px;
            font-family: 'Courier New', monospace;
        }
    </style>
</head>
<body>
    <h1>üîê Rust WASM Crypto Demo</h1>
    
    <!-- –°–∏–º–º–µ—Ç—Ä–∏—á–Ω–æ–µ —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ -->
    <div class="section">
        <h2>üîë –°–∏–º–º–µ—Ç—Ä–∏—á–Ω–æ–µ —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ (AES-256-GCM)</h2>
        
        <div class="controls">
            <button onclick="generateSymmetricKey()">–°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å —Å–∏–º–º–µ—Ç—Ä–∏—á–Ω—ã–π –∫–ª—é—á</button>
        </div>
        
        <div class="label">–°–∏–º–º–µ—Ç—Ä–∏—á–Ω—ã–π –∫–ª—é—á (32 –±–∞–π—Ç–∞, hex):</div>
        <textarea id="symmetricKey" placeholder="–°–≥–µ–Ω–µ—Ä–∏—Ä—É–π—Ç–µ –∫–ª—é—á..."></textarea>
        
        <div class="label">–¢–µ–∫—Å—Ç –¥–ª—è —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è:</div>
        <textarea id="symmetricText">–ü—Ä–∏–≤–µ—Ç, –º–∏—Ä! –≠—Ç–æ —Ç–µ—Å—Ç–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ.</textarea>
        
        <div class="controls">
            <button onclick="encryptSymmetric()">–ó–∞—à–∏—Ñ—Ä–æ–≤–∞—Ç—å</button>
            <button onclick="decryptSymmetric()">–†–∞—Å—à–∏—Ñ—Ä–æ–≤–∞—Ç—å</button>
        </div>
        
        <div class="label">–†–µ–∑—É–ª—å—Ç–∞—Ç:</div>
        <div class="result" id="symmetricResult"></div>
    </div>
    
    <!-- –ê—Å–∏–º–º–µ—Ç—Ä–∏—á–Ω–æ–µ —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ -->
    <div class="section">
        <h2>üóùÔ∏è –ê—Å–∏–º–º–µ—Ç—Ä–∏—á–Ω–æ–µ —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ (RSA-2048)</h2>
        
        <div class="controls">
            <button onclick="generateAsymmetricKeypair()">–°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –∫–ª—é—á–µ–≤—É—é –ø–∞—Ä—É</button>
        </div>
        
        <div class="label">–ü—Ä–∏–≤–∞—Ç–Ω—ã–π –∫–ª—é—á (PEM):</div>
        <textarea id="privateKey" placeholder="–ë—É–¥–µ—Ç —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω..."></textarea>
        
        <div class="label">–ü—É–±–ª–∏—á–Ω—ã–π –∫–ª—é—á (PEM):</div>
        <textarea id="publicKey" placeholder="–ë—É–¥–µ—Ç —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω..."></textarea>
        
        <div class="label">–¢–µ–∫—Å—Ç –¥–ª—è —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è:</div>
        <textarea id="asymmetricText">–°–µ–∫—Ä–µ—Ç–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –¥–ª—è RSA</textarea>
        
        <div class="controls">
            <button onclick="encryptAsymmetric()">–ó–∞—à–∏—Ñ—Ä–æ–≤–∞—Ç—å –ø—É–±–ª–∏—á–Ω—ã–º –∫–ª—é—á–æ–º</button>
            <button onclick="decryptAsymmetric()">–†–∞—Å—à–∏—Ñ—Ä–æ–≤–∞—Ç—å –ø—Ä–∏–≤–∞—Ç–Ω—ã–º –∫–ª—é—á–æ–º</button>
        </div>
        
        <div class="label">–†–µ–∑—É–ª—å—Ç–∞—Ç:</div>
        <div class="result" id="asymmetricResult"></div>
    </div>
    
    <!-- –£—Ç–∏–ª–∏—Ç—ã -->
    <div class="section">
        <h2>üõ†Ô∏è –£—Ç–∏–ª–∏—Ç—ã</h2>
        
        <div class="controls">
            <button onclick="generateRandomBytes()">–°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å —Å–ª—É—á–∞–π–Ω—ã–µ –±–∞–π—Ç—ã</button>
            <button onclick="hashData()">–í—ã—á–∏—Å–ª–∏—Ç—å SHA-256</button>
        </div>
        
        <div class="label">–î–∞–Ω–Ω—ã–µ –¥–ª—è —Ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è:</div>
        <textarea id="hashText">–î–∞–Ω–Ω—ã–µ –¥–ª—è —Ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è</textarea>
        
        <div class="label">–†–µ–∑—É–ª—å—Ç–∞—Ç:</div>
        <div class="result" id="utilsResult"></div>
    </div>
    
    <!-- –ö–æ–Ω—Å–æ–ª—å —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞ -->
    <div class="section">
        <h2>üíª –î–ª—è –∫–æ–Ω—Å–æ–ª–∏ —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞</h2>
        <p>–í—Å–µ —Ñ—É–Ω–∫—Ü–∏–∏ –¥–æ—Å—Ç—É–ø–Ω—ã –≥–ª–æ–±–∞–ª—å–Ω–æ —á–µ—Ä–µ–∑ <code>window.cryptoAPI</code></p>
        <pre><code>
// –î–æ—Å—Ç—É–ø–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏:
window.cryptoAPI.generate_symmetric_key()
window.cryptoAPI.encrypt_symmetric(plaintext, keyHex)
window.cryptoAPI.decrypt_symmetric(encryptedJson, keyHex)
window.cryptoAPI.generate_asymmetric_keypair()
window.cryptoAPI.encrypt_asymmetric(plaintext, publicKeyPem)
window.cryptoAPI.decrypt_asymmetric(ciphertextHex, privateKeyPem)
window.cryptoAPI.hash_sha256(data)
window.cryptoAPI.generate_random_bytes(count)
        </code></pre>
    </div>

    <script type="module">
        import init, { 
            generate_symmetric_key,
            encrypt_symmetric,
            decrypt_symmetric,
            generate_asymmetric_keypair,
            encrypt_asymmetric,
            decrypt_asymmetric,
            hash_sha256,
            generate_random_bytes
        } from './pkg/rust_wasm_crypto.js';
        
        let wasmInitialized = false;
        let cryptoAPI = {};
        
        async function initializeWasm() {
            if (!wasmInitialized) {
                await init();
                wasmInitialized = true;
                
                // –≠–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–µ–º —Ñ—É–Ω–∫—Ü–∏–∏ –≤ –≥–ª–æ–±–∞–ª—å–Ω—É—é –æ–±–ª–∞—Å—Ç—å –≤–∏–¥–∏–º–æ—Å—Ç–∏
                cryptoAPI = {
                    generate_symmetric_key,
                    encrypt_symmetric,
                    decrypt_symmetric,
                    generate_asymmetric_keypair,
                    encrypt_asymmetric,
                    decrypt_asymmetric,
                    hash_sha256,
                    generate_random_bytes
                };
                
                window.cryptoAPI = cryptoAPI;
                console.log('‚úÖ WASM Crypto API loaded! Available as window.cryptoAPI');
            }
        }
        
        // ========== –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ ==========
        
        async function generateSymmetricKey() {
            await initializeWasm();
            try {
                const key = await cryptoAPI.generate_symmetric_key();
                document.getElementById('symmetricKey').value = key;
                document.getElementById('symmetricResult').innerHTML = 
                    `<strong>–ö–ª—é—á —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω:</strong> ${key.substring(0, 50)}...`;
                console.log('Symmetric key:', key);
            } catch (error) {
                document.getElementById('symmetricResult').innerHTML = 
                    `<strong>–û—à–∏–±–∫–∞:</strong> ${error}`;
            }
        }
        
        async function encryptSymmetric() {
            await initializeWasm();
            try {
                const plaintext = document.getElementById('symmetricText').value;
                const key = document.getElementById('symmetricKey').value;
                
                if (!key) {
                    alert('–°–Ω–∞—á–∞–ª–∞ —Å–≥–µ–Ω–µ—Ä–∏—Ä—É–π—Ç–µ –∫–ª—é—á!');
                    return;
                }
                
                const encrypted = await cryptoAPI.encrypt_symmetric(plaintext, key);
                document.getElementById('symmetricResult').innerHTML = 
                    `<strong>–ó–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–æ:</strong><br>${encrypted}`;
                console.log('Encrypted (JSON):', encrypted);
            } catch (error) {
                document.getElementById('symmetricResult').innerHTML = 
                    `<strong>–û—à–∏–±–∫–∞ —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è:</strong> ${error}`;
            }
        }
        
        async function decryptSymmetric() {
            await initializeWasm();
            try {
                const key = document.getElementById('symmetricKey').value;
                const resultText = document.getElementById('symmetricResult').textContent;
                
                if (!resultText.includes('–ó–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–æ:')) {
                    alert('–°–Ω–∞—á–∞–ª–∞ –∑–∞—à–∏—Ñ—Ä—É–π—Ç–µ —á—Ç–æ-–Ω–∏–±—É–¥—å!');
                    return;
                }
                
                // –ò–∑–≤–ª–µ–∫–∞–µ–º JSON –∏–∑ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
                const jsonMatch = resultText.match(/{.*}/s);
                if (!jsonMatch) {
                    alert('–ù–µ –Ω–∞–π–¥–µ–Ω—ã –¥–∞–Ω–Ω—ã–µ –¥–ª—è —Ä–∞—Å—à–∏—Ñ—Ä–æ–≤–∫–∏!');
                    return;
                }
                
                const decrypted = await cryptoAPI.decrypt_symmetric(jsonMatch[0], key);
                document.getElementById('symmetricResult').innerHTML = 
                    `<strong>–†–∞—Å—à–∏—Ñ—Ä–æ–≤–∞–Ω–æ:</strong> ${decrypted}`;
                console.log('Decrypted:', decrypted);
            } catch (error) {
                document.getElementById('symmetricResult').innerHTML = 
                    `<strong>–û—à–∏–±–∫–∞ —Ä–∞—Å—à–∏—Ñ—Ä–æ–≤–∫–∏:</strong> ${error}`;
            }
        }
        
        async function generateAsymmetricKeypair() {
            await initializeWasm();
            try {
                const keypairJson = await cryptoAPI.generate_asymmetric_keypair();
                const keypair = JSON.parse(keypairJson);
                
                document.getElementById('privateKey').value = keypair.private_key;
                document.getElementById('publicKey').value = keypair.public_key;
                
                document.getElementById('asymmetricResult').innerHTML = 
                    `<strong>–ö–ª—é—á–µ–≤–∞—è –ø–∞—Ä–∞ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–∞!</strong><br>
                     <small>–ü—Ä–∏–≤–∞—Ç–Ω—ã–π –∫–ª—é—á: ${keypair.private_key.substring(0, 50)}...</small>`;
                console.log('Keypair generated');
            } catch (error) {
                document.getElementById('asymmetricResult').innerHTML = 
                    `<strong>–û—à–∏–±–∫–∞:</strong> ${error}`;
            }
        }
        
        async function encryptAsymmetric() {
            await initializeWasm();
            try {
                const plaintext = document.getElementById('asymmetricText').value;
                const publicKey = document.getElementById('publicKey').value;
                
                if (!publicKey) {
                    alert('–°–Ω–∞—á–∞–ª–∞ —Å–≥–µ–Ω–µ—Ä–∏—Ä—É–π—Ç–µ –∫–ª—é—á–µ–≤—É—é –ø–∞—Ä—É!');
                    return;
                }
                
                const encrypted = await cryptoAPI.encrypt_asymmetric(plaintext, publicKey);
                document.getElementById('asymmetricResult').innerHTML = 
                    `<strong>–ó–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–æ (hex):</strong><br>${encrypted}`;
                console.log('RSA Encrypted:', encrypted);
            } catch (error) {
                document.getElementById('asymmetricResult').innerHTML = 
                    `<strong>–û—à–∏–±–∫–∞ —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è:</strong> ${error}`;
            }
        }
        
        async function decryptAsymmetric() {
            await initializeWasm();
            try {
                const privateKey = document.getElementById('privateKey').value;
                const resultText = document.getElementById('asymmetricResult').textContent;
                
                if (!resultText.includes('–ó–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–æ')) {
                    alert('–°–Ω–∞—á–∞–ª–∞ –∑–∞—à–∏—Ñ—Ä—É–π—Ç–µ —á—Ç–æ-–Ω–∏–±—É–¥—å!');
                    return;
                }
                
                // –ò–∑–≤–ª–µ–∫–∞–µ–º hex –∏–∑ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
                const hexMatch = resultText.match(/([0-9a-f]{100,})/i);
                if (!hexMatch) {
                    alert('–ù–µ –Ω–∞–π–¥–µ–Ω—ã –¥–∞–Ω–Ω—ã–µ –¥–ª—è —Ä–∞—Å—à–∏—Ñ—Ä–æ–≤–∫–∏!');
                    return;
                }
                
                const decrypted = await cryptoAPI.decrypt_asymmetric(hexMatch[1], privateKey);
                document.getElementById('asymmetricResult').innerHTML = 
                    `<strong>–†–∞—Å—à–∏—Ñ—Ä–æ–≤–∞–Ω–æ:</strong> ${decrypted}`;
                console.log('RSA Decrypted:', decrypted);
            } catch (error) {
                document.getElementById('asymmetricResult').innerHTML = 
                    `<strong>–û—à–∏–±–∫–∞ —Ä–∞—Å—à–∏—Ñ—Ä–æ–≤–∫–∏:</strong> ${error}`;
            }
        }
        
        async function generateRandomBytes() {
            await initializeWasm();
            try {
                const bytes = await cryptoAPI.generate_random_bytes(32);
                document.getElementById('utilsResult').innerHTML = 
                    `<strong>32 —Å–ª—É—á–∞–π–Ω—ã—Ö –±–∞–π—Ç–∞ (hex):</strong><br>${bytes}`;
                console.log('Random bytes:', bytes);
            } catch (error) {
                document.getElementById('utilsResult').innerHTML = 
                    `<strong>–û—à–∏–±–∫–∞:</strong> ${error}`;
            }
        }
        
        async function hashData() {
            await initializeWasm();
            try {
                const data = document.getElementById('hashText').value;
                const hash = await cryptoAPI.hash_sha256(data);
                document.getElementById('utilsResult').innerHTML = 
                    `<strong>SHA-256 —Ö–µ—à:</strong><br>${hash}`;
                console.log('SHA-256:', hash);
            } catch (error) {
                document.getElementById('utilsResult').innerHTML = 
                    `<strong>–û—à–∏–±–∫–∞:</strong> ${error}`;
            }
        }
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        initializeWasm().catch(console.error);
        
        // –≠–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–µ–º –¥–ª—è –∫–æ–Ω—Å–æ–ª–∏ —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞
        window.initCrypto = initializeWasm;
    </script>
</body>
</html>